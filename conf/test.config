/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Nextflow config file for running minimal tests
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Defines input files and everything required to run a fast and simple pipeline test.

    Use as follows:
        nextflow run nf-core/sangersomatic -profile test,<docker/singularity> --outdir <OUTDIR>

----------------------------------------------------------------------------------------
*/

singularity {
    enabled = true
    autoMounts = true
}

process {
    resourceLimits = [
        cpus: 4,
        memory: '15.GB',
        time: '1.h'
    ]

    withLabel: caveman {
        container = "/software/CASM/singularity/cgpcavemanwrapper/cgpcavemanwrapper_1.19.1.sif"
    }

    withName: cgpPindel {
        container = "/software/CASM/singularity/cgppindel/cgppindel_3.10.0.sif"
    }

    withName: cgpBigWig {
        container = "/software/CASM/singularity/pcap-core/pcap-core_5.7.0.sif"
    }

    withName: vafAugment {
        container = "/software/CASM/singularity/vafcorrect/vafcorrect_5.7.2.sif"
    }

    withLabel: vagrent {
        container = "/software/CASM/singularity/vagrent/vagrent_v3.6.1.sif"
    }

    // withName: cavemanMstep {
    //     executor {
    //         name = 'lsf'
    //         perJobMemLimit = true
    //         poolSize = 4
    //         submitRateLimit = '5 sec'
    //         killBatchSize = 50
    //     }
    //     queue = 'week'
    //     memory = '8000 MB'
    //     cpus = 1
    // }

    // withName: cavemanEstep {
    //     executor {
    //         name = 'lsf'
    //         perJobMemLimit = true
    //         poolSize = 4
    //         submitRateLimit = '5 sec'
    //         killBatchSize = 50
    //     }
    //     queue = 'week'
    //     memory = '8000 MB'
    //     cpus = 1
    // }

    // withName: cavemanMergeEstep {
    //     executor {
    //         name = 'lsf'
    //         perJobMemLimit = true
    //         poolSize = 4
    //         submitRateLimit = '5 sec'
    //         killBatchSize = 50
    //     }
    //     queue = 'week'
    //     memory = '5000 MB'
    //     cpus = 1
    // }

}

params {
    config_profile_name        = 'Test profile'
    config_profile_description = 'Minimal test dataset to check pipeline function'

    // Input data
    // TODO nf-core: Specify the paths to your test data on nf-core/test-datasets
    // TODO nf-core: Give any required params for the test so that command line flags are not needed
    input  = params.pipelines_testdata_base_path + 'viralrecon/samplesheet/samplesheet_test_illumina_amplicon.csv'
    pindel_ncpus = 4
    bamtobw_threads = 4
    vafaugment_exonerate_mb = 12000

}

